/*!
 * Name: panopticon
 * Id: panopticon
 * Version: 1.0.3
 * Description:
 * Author:  ()
 * Repository:
 */
define(["react","code-plug","../../src/components","rsuite","../../../src/components","graphql-tag","react-router-dom","react-apollo","prop-types","lodash","classnames"],(e,t,r,n,l,o,a,i,s,c,u)=>(()=>{var p={21:(e,t,r)=>{var n=r(645);(e.exports=n(!1)).push([e.id,".secret-viewer .display-secret{padding:4px 10px;font-family:monospace;background-color:#eeeeee;border:1px solid #bbbbbb}.secret-viewer .secret-reveal-at{font-size:40px;font-weight:bolder}\n",""])},645:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var r=function(e,t){var r=e[1]||"",n=e[3];if(!n)return r;if(t&&"function"==typeof btoa){var l=(a=n,i=btoa(unescape(encodeURIComponent(JSON.stringify(a)))),s="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(i),"/*# ".concat(s," */")),o=n.sources.map((function(e){return"/*# sourceURL=".concat(n.sourceRoot).concat(e," */")}));return[r].concat(o).concat([l]).join("\n")}var a,i,s;return[r].join("\n")}(t,e);return t[2]?"@media ".concat(t[2],"{").concat(r,"}"):r})).join("")},t.i=function(e,r){"string"==typeof e&&(e=[[null,e,""]]);for(var n={},l=0;l<this.length;l++){var o=this[l][0];null!=o&&(n[o]=!0)}for(var a=0;a<e.length;a++){var i=e[a];null!=i[0]&&n[i[0]]||(r&&!i[2]?i[2]=r:r&&(i[2]="(".concat(i[2],") and (").concat(r,")")),t.push(i))}},t}},982:(e,t,r)=>{var n=r(21);"string"==typeof n&&(n=[[e.id,n,""]]);var l={insert:"head",singleton:!1};r(379)(n,l);n.locals&&(e.exports=n.locals)},379:(e,t,r)=>{"use strict";var n,l={},o=function(){return void 0===n&&(n=Boolean(window&&document&&document.all&&!window.atob)),n},a=function(){var e={};return function(t){if(void 0===e[t]){var r=document.querySelector(t);if(window.HTMLIFrameElement&&r instanceof window.HTMLIFrameElement)try{r=r.contentDocument.head}catch(e){r=null}e[t]=r}return e[t]}}();function i(e,t){for(var r=[],n={},l=0;l<e.length;l++){var o=e[l],a=t.base?o[0]+t.base:o[0],i={css:o[1],media:o[2],sourceMap:o[3]};n[a]?n[a].parts.push(i):r.push(n[a]={id:a,parts:[i]})}return r}function s(e,t){for(var r=0;r<e.length;r++){var n=e[r],o=l[n.id],a=0;if(o){for(o.refs++;a<o.parts.length;a++)o.parts[a](n.parts[a]);for(;a<n.parts.length;a++)o.parts.push(b(n.parts[a],t))}else{for(var i=[];a<n.parts.length;a++)i.push(b(n.parts[a],t));l[n.id]={id:n.id,refs:1,parts:i}}}}function c(e){var t=document.createElement("style");if(void 0===e.attributes.nonce){var n=r.nc;n&&(e.attributes.nonce=n)}if(Object.keys(e.attributes).forEach((function(r){t.setAttribute(r,e.attributes[r])})),"function"==typeof e.insert)e.insert(t);else{var l=a(e.insert||"head");if(!l)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");l.appendChild(t)}return t}var u,p=(u=[],function(e,t){return u[e]=t,u.filter(Boolean).join("\n")});function d(e,t,r,n){var l=r?"":n.css;if(e.styleSheet)e.styleSheet.cssText=p(t,l);else{var o=document.createTextNode(l),a=e.childNodes;a[t]&&e.removeChild(a[t]),a.length?e.insertBefore(o,a[t]):e.appendChild(o)}}function m(e,t,r){var n=r.css,l=r.media,o=r.sourceMap;if(l&&e.setAttribute("media",l),o&&btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}var h=null,g=0;function b(e,t){var r,n,l;if(t.singleton){var o=g++;r=h||(h=c(t)),n=d.bind(null,r,o,!1),l=d.bind(null,r,o,!0)}else r=c(t),n=m.bind(null,r,t),l=function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(r)};return n(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;n(e=t)}else l()}}e.exports=function(e,t){(t=t||{}).attributes="object"==typeof t.attributes?t.attributes:{},t.singleton||"boolean"==typeof t.singleton||(t.singleton=o());var r=i(e,t);return s(r,t),function(e){for(var n=[],o=0;o<r.length;o++){var a=r[o],c=l[a.id];c&&(c.refs--,n.push(c))}e&&s(i(e,t),t);for(var u=0;u<n.length;u++){var p=n[u];if(0===p.refs){for(var d=0;d<p.parts.length;d++)p.parts[d]();delete l[p.id]}}}}},570:e=>{"use strict";e.exports=l},727:e=>{"use strict";e.exports=r},303:e=>{"use strict";e.exports=u},737:e=>{"use strict";e.exports=t},697:e=>{"use strict";e.exports=o},980:e=>{"use strict";e.exports=c},207:e=>{"use strict";e.exports=s},650:t=>{"use strict";t.exports=e},287:e=>{"use strict";e.exports=i},814:e=>{"use strict";e.exports=a},131:e=>{"use strict";e.exports=n}},d={};function m(e){var t=d[e];if(void 0!==t)return t.exports;var r=d[e]={id:e,exports:{}};return p[e](r,r.exports,m),r.exports}m.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return m.d(t,{a:t}),t},m.d=(e,t)=>{for(var r in t)m.o(t,r)&&!m.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},m.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),m.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var h={};return(()=>{"use strict";m.r(h);var e=m(650),t=m.n(e),r=m(737),n=m(727),l=m(131),o=m(570);let a;null!=window.AppContext?a=window.AppContext:(a=t().createContext({}),window.AppContext=a);const i=e=>"location"===e?"#5E8263":e?"#D36135":e?"#595D88":"#000000";m(982);const s=()=>t().createElement(l.Icon,{className:"map-marker",icon:"map-marker",size:"2x",style:{color:"red"}}),c=({record:e})=>{const{payload:r}=e,n=new Date(r.secret_duration),a=new Date,c=n.getTime()-a.getTime();return t().createElement("div",{className:"secret-viewer"},t().createElement(l.FlexboxGrid,{justify:"space-between",style:{marginTop:"30px"}},t().createElement(l.FlexboxGrid.Item,{colspan:7},t().createElement("div",null,t().createElement("b",null,"Secret is")," ",t().createElement(o.SmallTag,{color:i(r.secret_type)},r.secret_type)),("time"===r.secret_type||"location+time"===r.secret_type)&&t().createElement("div",null,t().createElement("b",null,"Revealed when"),t().createElement("br",null),t().createElement("em",null,n.toLocaleDateString(),", ",n.toLocaleTimeString()),c>0&&t().createElement("div",{className:"secret-reveal-at"},Math.round(c/1e3/60)," minutes"),c<0&&t().createElement("div",null,"Secret date is due")),null!=r.secret_bounty&&t().createElement(t().Fragment,null,t().createElement("b",null,"ICE price:")," ",r.secret_bounty," EUR",t().createElement("br",null)),null!=r.secret_payment&&t().createElement(t().Fragment,null,t().createElement("br",null),t().createElement("b",null,"User paid to reveal the secret"),t().createElement("br",null),t().createElement("b",null,"Email: ")," ",r.secret_payment.order_info.email,t().createElement("br",null),t().createElement("b",null,"Currency: ")," ",r.secret_payment.currency,t().createElement("br",null),t().createElement("b",null,"Amount: ")," ",(r.secret_payment.total_amount/100).toFixed(2),t().createElement("br",null),t().createElement("b",null,"Payment ID: ")," ",r.secret_payment.provider_payment_charge_id,t().createElement("br",null))),t().createElement(l.FlexboxGrid.Item,{colspan:7},null!=r.secret_url&&t().createElement("div",null,t().createElement("b",null,"Secret image"),t().createElement("img",{src:r.secret_url,width:"100%"})),null!=r.secret&&t().createElement("div",null,t().createElement("b",null,"Secret text"),t().createElement("div",{className:"display-secret"},r.secret))),t().createElement(l.FlexboxGrid.Item,{colspan:7},null!=e.latitude&&t().createElement("div",{className:"ui-devices-map",style:{height:"300px"}},t().createElement(o.Maps,{defaultCenter:{lat:e.latitude,lng:e.longitude},defaultZoom:11},t().createElement(s,null))),null==e.latitude&&t().createElement("div",null,t().createElement("em",null,"No location for this secret")))))};var u=m(697),p=m.n(u),d=m(814),g=m(287),b=m(207),f=m.n(b),v=m(980),y=m.n(v),E=m(303),w=m.n(E);function x(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class k extends t().Component{render(){const{thumb:e,height:r,width:n,maxWidth:l,maxHeight:o}=this.props,a=r/n;let i=Math.floor(a*l);i>o&&(i=o);const s={backgroundImage:`url(${e})`,backgroundPosition:"center",width:l+"px",height:i+"px"};return t().createElement("div",{style:s})}}x(k,"propTypes",{thumb:f().string,height:f().number,width:f().number,maxWidth:f().number,maxHeight:f().number,onClick:f().func}),x(k,"defaultProps",{thumb:null,height:null,width:null,maxWidth:200,maxHeight:400,onClick:()=>{}});const C=k;function S(){return(S=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}const P=({topic:e,ts:r,content:n,onDelete:o,onZoom:a,thumb:i,image:s,width:c,height:u,maxHeight:p,...d})=>{let m;return y().isEmpty(i)||(m=t().createElement(C,{thumb:i,topic:e,width:c,height:u,maxHeight:p,onClick:()=>{console.log("clicked"),a({})}})),t().createElement(l.Popover,S({title:e},d,{onMouseLeave:()=>{}}),t().createElement("div",{className:"popover-map-marker"},"vario"))};P.propTypes={topic:f().string,thumb:f().string,image:f().string,content:f().string,ts:f().instanceOf(Date),onDelete:f().func,width:f().number,height:f().number},P.defaultProps={topic:null,thumb:null,image:null,content:null,ts:null,onDelete:()=>{},width:null,height:null};function _(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class M extends t().Component{constructor(e){super(e),this.handleLoaded=this.handleLoaded.bind(this),this.handleClick=this.handleClick.bind(this);const{thumb:t}=e;this.state={needPreload:!y().isEmpty(t),preload:!1,width:null,height:null}}componentDidMount(){const{type:e,color:t}=this.props;null!=this.tooltip&&"tooltip"===e&&(this.tooltip.querySelector(".rs-tooltip-inner").style.backgroundColor=t,this.tooltip.querySelector(".rs-tooltip-arrow").style.backgroundColor=t)}handleLoaded(e){this.setState({preload:!1,width:e.target.width,height:e.target.height},()=>this.trigger.show())}handleClick(e){e.preventDefault(),e.stopPropagation();const{thumb:t}=this.props;y().isEmpty(t)?this.trigger.show():this.setState({preload:!0})}render(){const{children:e,point:r,text:n,type:o,popover:a,showPopover:i,thumb:s,image:c,inkColor:u,maxHeight:p,onDeletePoint:d,onShowImage:m}=this.props;let{icon:h,color:g,size:b}=this.props;const{height:f,width:v,preload:E,needPreload:x}=this.state;y().isEmpty(h)&&(h="map-marker"),y().isEmpty(b)&&(b="lg"),y().isEmpty(g)&&(g="#FF3300"),y().isEmpty(u)&&(g="#000000");new Date(parseInt(r.ts,10));let k;switch(o){case"icon":k=t().createElement("a",{href:"#",className:w()("wrapper-map-marker",{preload:E}),onClick:this.handleClick},E&&t().createElement("img",{src:s,style:{display:"none"},onLoad:this.handleLoaded,alt:""}),t().createElement(l.Icon,{className:w()("map-marker",{pointer:i}),icon:h,size:b,style:{color:g}}));break;case"tooltip":k=t().createElement("div",{ref:e=>this.tooltip=e,style:{height:20,backgroundColor:"#ff0000"}},t().createElement(l.Tooltip,{visible:!0},t().createElement("span",{style:{color:u}},n)));break;default:k=null}if(i){if(x&&E)return k;const r=t().createElement(l.Popover,{onMouseLeave:()=>{}},t().createElement("div",{className:"popover-map-marker"},e));return t().createElement(l.Whisper,{trigger:"click",placement:"top",speaker:r,triggerRef:e=>this.trigger=e},k)}return k}}_(M,"propTypes",{point:f().shape({topic:f().string,text:f().string,ts:f().string}).isRequired,icon:f().string,size:f().string,color:f().string,text:f().string,popover:f().string,thumb:f().string,image:f().string,showPopover:f().bool,type:f().oneOf(["icon","tooltip"]),inkColor:f().string,maxHeight:f().number}),_(M,"defaultProps",{icon:"map-marker",color:"#FF3300",text:null,size:"2x",popover:null,thumb:null,image:null,type:"icon",showPopover:!1,inkColor:"#ffffff",maxHeight:480});const N=M,T=p()`
query($where: JSON) {
  records(limit: 50, order: "geohash", where: $where) {
    id,
    status,
    title,
    latitude,
    longitude,
    geohash,
    payload
  }
}`,j=()=>{const[r,n]=(0,e.useState)(null),[a,i]=(0,e.useState)(!1),s=(0,g.useApolloClient)();let c=(r||[]).filter(e=>null!=e.latitude&&null!=e.longitude).map(e=>t().createElement(N,{key:e.id,lat:e.latitude,lng:e.longitude,point:{},popover:e.title,showPopover:!0},t().createElement("div",{style:{minHeight:"120px"}},t().createElement("strong",null,e.title),null!=e.payload.secret_url&&t().createElement("div",{style:{backgroundImage:`url(${e.payload.secret_url})`,backgroundPosition:"center",minWidth:"120px",backgroundRepeat:"no-repeat",backgroundSize:"contain",height:"120px"}}),null!=e.payload.secret&&t().createElement("div",null,e.payload.secret),t().createElement(d.Link,{to:"/record/"+e.id},"view"))));return t().createElement(o.PageContainer,{className:"my-page"},t().createElement(o.Breadcrumbs,{pages:["Secret locations"]}),t().createElement("div",{style:{width:"100%",height:"450px",position:"relative"}},a&&t().createElement("div",{style:{position:"absolute",top:"20px",left:"20px",zIndex:1e7}},t().createElement(l.Loader,{size:"md"})),t().createElement(o.Maps,{defaultCenter:{lat:45.4854739,lng:9.2022176},defaultZoom:11,height:450,onChange:async({bounds:e})=>{const{se:t,nw:r}=e;i(!0);const{data:{records:l}}=await s.query({query:T,variables:{where:{latitude:{gte:t.lat,lte:r.lat},longitude:{gte:r.lng,lte:t.lng}}},fetchPolicy:"network-only"});n(l),i(!1)}},c)))};(0,r.plug)("sidebar",null,{id:"wiggle",label:"Panopticon",icon:"logo-survey",permission:"wiggle.view",options:[{id:"wiggle-secrets",label:"Secrets",url:"/secrets"},{id:"wiggle-secrets-map",label:"Secrets Map",url:"/secrets-map"}]}),(0,r.plug)("pages",j,{url:"/secrets-map",title:"Secrets Map",id:"secrets-maps",permission:"wiggle.view",breadcrumbs:["Secrets Map"]}),(0,r.plug)("pages",n.UserRecords,{url:"/secrets",title:"Secrets",id:"secrets",type:"secret",permission:"wiggle.view",breadcrumbs:["Secrets"],labels:{title:"Name",record:"secret"},columns:[{id:"secret-type",label:"Type",width:120,cell:({payload:e})=>t().createElement(n.SmallTag,{color:i(e.secret_type)},e.secret_type)}]}),(0,r.plug)("permissions",null,{permission:"wiggle.view",name:"View Panopticon secret",description:"View secrets stored in Panopticon Bot",group:"Panopticon"}),(0,r.plug)("user-record-types",null,{type:"secret",name:"Secret",list:"Secrets",description:"List of Panopticon secrets",form:c,status:[{value:"private",label:"Private"},{value:"public",label:"Public"},{value:"crazy",label:"Crazy"},{value:"keyholder-free",label:"Keyholder free"},{value:"keyholder-taken",label:"Keyholder taken"}]})})(),h})());